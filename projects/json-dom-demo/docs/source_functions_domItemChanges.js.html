<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: source/functions/domItemChanges.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: source/functions/domItemChanges.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import 'core-js/stable'
import siFunciona from 'si-funciona'
import elementHasAttribute from './elementHasAttribute.js'
import generateElement from './generateElement.js'

const checkAttribute = element =>
  (attr, key) => {
    if (typeof attr === 'object') {
      const styleDiff = elementHasAttribute(element, key, attr)
      // Check new, removed, or changed styles
      return siFunciona.filterObject(
        styleDiff,
        arrayDiff => {
          if (arrayDiff.result[0] === 0) {
            return element[key][arrayDiff.value] !== attr[arrayDiff.value]
          }
          return arrayDiff.result[0] === 1
        }
      )
    }
    if (key === 'className') {
      const classDiff = elementHasAttribute(element, key, attr)
      // Check new or removed class names
      return siFunciona.filterObject(
        classDiff,
        arrayDiff => arrayDiff.result[0] !== -1
      )
    }
    // True when the element does not already have the attribute
    return !elementHasAttribute(element, key, attr)
  }

/**
 * Given a domObjects.DomItem as domItem, this function will return the changes to be applied
 * to the stored element property.
 * @function
 * @memberOf module:domFunctions
 * @param {DomItem} domItem - The DomItem having changes to be applied to its element
 * @returns {DomItem}
 */
const domItemChanges = domItem => {
  if (!domItem.element) {
    return domItem
  }
  if (!domItem.element.tagName || domItem.element.tagName.toLowerCase() !== domItem.tagName.toLowerCase()) {
    // Generate a new element since the tag has changed
    return generateElement(domItem)
  }
  const diffMap = siFunciona.mapObject(
    domItem.attributes,
    (attr, key) => checkAttribute(domItem.element)(attr, key)
  )
  domItem.attributes = siFunciona.reduceObject(
    diffMap,
    (changed, result, key) => {
      const isArray = Array.isArray(result)
      if (!isArray &amp;&amp; !result) {
        return changed
      }
      if (!isArray) {
        changed[key] = domItem.attributes[key]
        return changed
      }
      if (key !== 'className' &amp;&amp; key !== 'style') {
        return changed
      }
      const sortedResults = result.sort(
        (current, next) => {
          const currentKeys = current.keys[1]
          const nextKeys = next.keys[1]
          if (!currentKeys.length) {
            return !nextKeys.length ? 0 : 1
          }
          if (!nextKeys.length) {
            return -1
          }
          const currentIndex = currentKeys[0]
          const nextIndex = nextKeys[0]
          if (currentIndex !== nextIndex) {
            return currentIndex &lt; nextIndex ? -1 : 1
          }
          return 0
        }
      )
      if (key === 'className') {
        changed[key] = sortedResults.reduce(
          (classes, classResult) => {
            if (classes !== '') {
              classes += ' '
            }
            classes += classResult.value
            return classes
          },
          ''
        )
        return changed
      }
      changed[key] = sortedResults.reduce(
        (styles, styleResult) => {
          styles[styleResult.value] = domItem.attributes[key][styleResult.value]
          return styles
        },
        {}
      )
      return changed
    },
    {}
  )

  return domItem
}

export default domItemChanges
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-domFunctions.html">domFunctions</a></li><li><a href="module-domObjects.html">domObjects</a></li><li><a href="module-jsonDom.html">jsonDom</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkClasses">checkClasses</a></li><li><a href="global.html#checkStyles">checkStyles</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Tue Mar 08 2022 23:33:28 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
