"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(function(){var e=this||{},t=e.gameUtils||{},r={};e.gameUtils=r,r.noConflict=function(){return e.gameUtils=t,r};var n=e.jDomMatrixCore;void 0===n&&("undefined"!=typeof require?n=require("../jDom/matrix/core.js"):console.error("functions.js requires jDom/matrix/core")),r.checkIfShipCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].hasShip},r.checkIfHitCell=function(e,t){return t.children[e.z].children[e.y].children[e.x].isHit},r.getAllNonHitCells=function(e){return n.getAllPoints(e).filter((function(t){return!r.checkIfHitCell(t,e)}))},r.getAdjEdgeNonHitCells=function(e,t){return n.adjacentEdgePoints(e,t).filter((function(e){return!r.checkIfHitCell(e,t)}))},r.getALowStatusItem=function(e){return e.reduce((function(e,t){return t.status<=e.status?t:e}))},r.getLowStatusItems=function(e){return e.filter((function(t){return t.status<=r.getALowStatusItem(e).status}))},r.getBrokenItems=function(e){return e.filter((function(e){return e.status<100&&e.status>0}))},r.getBrokenShipsPlayers=function(e){return e.filter((function(e){return r.getBrokenItems(e.shipFleet).length}))},r.numDamagedParts=function(e,t){return e-Math.ceil(t/100*e)},r.filterAdjacentPoints=function(e){return e.z%2==0&&(e.x%2==0&&e.y%2==0||e.x%2!=0&&e.y%2!=0)||e.z%2!=0&&(e.x%2!=0&&e.y%2==0||e.x%2==0&&e.y%2!=0)},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}).call(window||base||{}),function(){var e=this||{},t=e.gameActions||{},r={};e.gameActions=r,r.noConflict=function(){return e.gameActions=t,r};var n=e.jDomCore;void 0===n&&("undefined"!=typeof require?n=require("../jDom/core/core.js"):console.error("actions.js requires jDom/core/core"));var o=e.jDomCoreDom;void 0===o&&("undefined"!=typeof require?o=require("../jDom/core/dom/core.js"):console.error("actions.js requires jDom/core/dom/core"));var i=e.jDomMatrixObjects;void 0===i&&("undefined"!=typeof require?i=require("../jDom/matrix/objects.js"):console.error("actions.js requires jDom/matrix/objects"));var a=e.jDomMatrixCore;void 0===a&&("undefined"!=typeof require?a=require("../jDom/matrix/core.js"):console.error("actions.js requires jDom/matrix/core"));var u=e.gameLayout;void 0===u&&("undefined"!=typeof require?u=require("./layout.js"):console.error("actions.js requires game/layout"));var s=e.gamePieces;void 0===s&&("undefined"!=typeof require?s=require("./pieces.js"):console.error("actions.js requires game/pieces"));var c=e.gameUtils;void 0===c&&("undefined"!=typeof require?c=require("./functions.js"):console.error("actions.js requires game/functions"));var l=function(e,t){return t?(r.attackFleet.isLocked=!0,n.queueTimeout((function(){return e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=o.updateElement(e),r.attackFleet.isLocked=!1,e}),0)):(e.isHit&&(e.attributes.style.backgroundColor=e.hasShip?"red":"white"),e=o.updateElement(e)),e},d=function(e,t,r,o,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return l(n.mergeObjectsMutable(t.children[i].children[o].children[r],e),a)},m=n.curry(d)(n.mergeObjects(s.shipTile(),{attributes:{style:{backgroundColor:"#777"}}})),f=n.curry(d)(s.shipTile()),p=n.curry(d)(s.hitTile());r.setShip=function(e,t,r){return r?m(e,t.x,t.y,t.z):f(e,t.x,t.y,t.z)};var g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Math.round(100*e.status)/100,"%");return e.playerStats=o.updateElements(n.mergeObjects(e.playerStats,s.playerStats(e,t))),e};r.updatePlayer=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.attacker&&(t?++e.attacks.hit:++e.attacks.miss,i&&++e.attacks.sunk),t||(e.attacker=!e.attacker,r.attackFleet.isLocked=!0,e.attacker?(e.isRobot||n.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return o.updateElement(n.mergeObjects(e,{attributes:{style:{width:"17px",height:"17px"}}}))}))}))}))}),400),++e.turnCnt):n.queueTimeout((function(){return r.attackFleet.isLocked=!1,e.board.children.map((function(e){return e.children.map((function(e){return e.children.map((function(e){return o.updateElement(n.mergeObjects(e,{attributes:{style:{width:"35px",height:"35px"}}}))}))}))}))}),0));var a=n.queueTimeout((function(){return g(e,e.attacker?"ATTACKER":"".concat(Math.round(100*e.status)/100,"%"))}),0);return a.result||e};var h=function(e,t,i,a){var s=(a=a.filter((function(e){return e.status>0}))).reduce((function(e,t){return e.attacker?e:t}));if(s=r.updatePlayer(s,t,i),a.length<2)return n.queueTimeout((function(){return function(e){var t=o.getTopParentItem(e),r=e.parentItem.children;return r.map((function(e){return g(e)})),e=g(e,"WINNER"),o.renderHTML(u.finalScore(r),t).children[0].children.map((function(e){return e.attributes.innerHTML})),[n.trace("Winner")(e)]}(a[0])}),200);var c=function(e,t,n){return n?e:r.updatePlayer(function e(t,r,n){var o=r.length>1&&n>=r.length-1?r[0]:r[++n];return o.status>0?o:e(t,r,n)}(e,t,t.indexOf(e)),n)}(s,a,t);return c.isRobot&&n.queueTimeout(r.computerAttack,0,c,a),a};r.attackFleet=function(e){r.attackFleet.isLocked=r.attackFleet.isLocked||!1;var t=o.getParentsByClass("player",e)[0],n=o.getParentsByClass("boards",e)[0].children;if(t.status<=0||t.attacker||r.attackFleet.isLocked)return n;var i=p(t.board,e.point.x,e.point.y,e.point.z,n.reduce((function(e,t){return e.attacker?e:t})).isRobot),u=!1,s=0;if(i.hasShip){var c=0;t.shipFleet.map((function(t){var r=t.parts.filter((function(r){return a.areEqualPoints(r.point,e.point)&&(u=t),!r.isHit}));return t.status=r.length/t.parts.length*100,c+=t.status,t})),t.status=c/t.shipFleet.length}return u&&(t=g(t,"".concat(Math.round(100*t.status)/100,"%")),s=u.status<=0?u.parts.length:0),h(0,i.hasShip,s,n)},r.attackListener=function(e,t){return r.attackFleet(a.getDomItemFromElement(e.target,t))};var y=function(e,t,r){return[n.queueTimeout(v,0,{targets:e,victim:r}),n.queueTimeout(v,200,{targets:e,target:t,victim:r})]},v=function(e){return e.victim.board.children.map((function(e){return o.updateElement(n.mergeObjects(e,{attributes:{style:{borderColor:"#333"}}}))})),e.targets.forEach((function(t){return o.updateElement(n.mergeObjects(a.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"#333"}}}))})),e.target||(e.victim.board.children.map((function(e){return o.updateElement(n.mergeObjects(e,{attributes:{style:{borderColor:"yellow"}}}))})),e.targets.forEach((function(t){return o.updateElement(n.mergeObjects(a.getDomItemFromPoint(t,e.victim.board),{attributes:{style:{borderColor:"yellow"}}}))}))),e};r.computerAttack=function(e,t){var o=function(e){var t=c.getBrokenShipsPlayers(e).length?c.getBrokenShipsPlayers(e):c.getLowStatusItems(e);return 1===t.length?t[0]:t[n.randomInteger(t.length)]}(t.filter((function(e){return!e.attacker})));return r.attackFleet.isLocked=!1,r.attackFleet(function(e){var t=c.getBrokenItems(e.shipFleet),r=[];if(t.length){var o=t.filter((function(e){return c.numDamagedParts(e.parts.length,e.status)>1})),u=c.getALowStatusItem(o.length?o:t).parts.filter((function(t){return c.checkIfHitCell(t.point,e.board)}));if(o.length){for(var s=0;s<u.length;++s){var l=a.testPointsBetween(u[0].point,u[s].point,e.board,c.checkIfHitCell,!1);if(l.false.length)return y(l.false,l.false[0],e),a.getDomItemFromPoint(l.false[0],e.board)}var d=(a.pointDifference(u[0].point,u[1].point).x>0?[i.point(-1,0,0),i.point(1,0,0)]:[i.point(0,-1,0),i.point(0,1,0)]).map((function(e,t){return a.nextCell(u[(u.length-1)*t].point,e)})).filter((function(t){return a.checkValidPoint(t,e.board)})).filter((function(t){return!c.checkIfHitCell(t,e.board)})),m=d.reduce((function(t,r){return c.checkIfHitCell(t,e.board)?r:t}));if(m)return y(d,m,e),a.getDomItemFromPoint(m,e.board)}r=c.getAdjEdgeNonHitCells(u[0].point,e.board)}var f=r.length?r:c.getAllNonHitCells(e.board).filter((function(e){return c.filterAdjacentPoints(e)})),p=f[n.randomInteger(f.length)];return y(f,p,e),a.getDomItemFromPoint(p,e.board)}(o))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||base||{}),function(){var e=this||{},t=e.gameStart||{},r={};e.gameStart=r,r.noConflict=function(){return e.gameStart=t,r};var n=e.jDomCore;void 0===n&&("undefined"!=typeof require?n=require("../jDom/core/core.js"):console.error("setup.js requires jDom/core/core"));var o=e.jDomCoreDom;void 0===o&&("undefined"!=typeof require?o=require("../jDom/core/dom/core.js"):console.error("setup.js requires jDom/core/dom/core"));var i=e.jDomMatrixCore;void 0===i&&("undefined"!=typeof require?i=require("../jDom/matrix/core.js"):console.error("setup.js requires jDom/matrix/core"));var a=e.jDomMatrixObjects;void 0===a&&("undefined"!=typeof require?a=require("../jDom/matrix/objects.js"):console.error("setup.js requires jDom/matrix/objects"));var u=e.gameLayout;void 0===u&&("undefined"!=typeof require?u=require("./layout.js"):console.error("setup.js requires game/layout"));var s=e.gamePieces;void 0===s&&("undefined"!=typeof require?s=require("./pieces.js"):console.error("setup.js requires game/pieces"));var c=e.gameUtils;void 0===c&&("undefined"!=typeof require?c=require("./functions.js"):console.error("setup.js requires game/functions"));var l=e.gameActions;void 0===l&&("undefined"!=typeof require?l=require("./actions.js"):console.error("setup.js requires game/actions"));var d=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return n.mergeObjects(s.ship(e.name),{parts:t.map((function(e){return l.setShip(r,e,o)}))})},m=function(e,t){return i.randDirection([a.point(1,0,0),a.point(0,1,0),a.point(0,0,1)].filter((function(r){return e[i.getFirstAxisOfCoordinate(r,1)]>t})))},f=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m(e,t);return{start:i.randomStart(t,r,e),dir:r}},p=function e(t,r,n){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f(n,r);return 0===i.getHighestAbsoluteCoordinate(u.dir)?[a.point(0,0,0),a.point(0,0,0)]:(o=i).checkInBetween.apply(o,[u.start,i.lineEndPoint(u.start,r,u.dir)].concat([t,c.checkIfShipCell]))?e(t,r,n):[u.start,i.lineEndPoint(u.start,r,u.dir)]},g=n.curry((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map((function(e){var n;return d(e,(n=i).getPointsLine.apply(n,_toConsumableArray(p(t,e.size,i.getAxisLengths(t)))),t,r)}))}))([{name:"Aircraft Carrier",size:5},{name:"Battleship",size:4},{name:"Submarine",size:3},{name:"Cruiser",size:3},{name:"Destroyer",size:2}]);r.beginRound=function(e,t){console.log("beginRound",e.eventPhase,e.type),e.preventDefault();var r=o.getTopParentItem(t),c=parseInt(o.getChildrenByName("human-players",t)[0].element.value),d=parseInt(o.getChildrenByName("robot-players",t)[0].element.value);if(c<0||c>100||d<0||d>100)return!1;var m=o.getChildrenByName("first-go-first",t)[0].element.checked;0===(c=c<0?0:c)&&(d=d<2?2:d),1===c&&(d=d<1?1:d),o.removeChild(o.getChildrenByClass("main-menu",r.body)[0],r.body);var f=o.renderHTML(u.boards(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(t<1&&r<1)return n;var o=s.playerSet({},"Player ".concat(n.length+1));return o.isRobot=t<=0,o.board=i.bindPointData(a.square({x:[s.waterTile(o,n)],matrixProps:[{eventListeners:{click:{listenerFunc:"attackListener",listenerArgs:{},listenerOptions:!1}}}]},10)),o.shipFleet=g(o.board,!1),o.playerStats=s.playerStats(o,"".concat(Math.round(100*o.status)/100,"%")),o.children=[o.board,o.playerStats],n.push(o),e(--t,t<0?--r:r,n)}(c,d)),r).children,p=l.updatePlayer(m?f[0]:f[n.randomInteger(f.length)]);return p.isRobot&&l.computerAttack(p,f),!1},r.main=function(e){for(var t=e.body.children.length-1;t>=0;--t)o.removeChild(e.body.children[t],e.body);return o.renderHTML(u.mainMenu(),e),e},r.restart=function(e,t){return r.main(o.getTopParentItem(t))},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports=Object.assign(exports,r))}.call(window||base||{});